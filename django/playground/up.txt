âœ³ï¸ ğŸ‘‰ ğŸ’¥

ğŸ’¥ Fundamentals ğŸ’¥
âœ³ï¸ activate virtual environmetn for the project ğŸ‘‰ pipenv shell
âœ³ï¸ start django project ğŸ‘‰ django-admin startproject <name> .
âœ³ï¸ find the path to project's venv ğŸ‘‰ pipenv --venv, take this and then ctrl+shift+p -> python interpreter -> /bin/python to use this interpreter
âœ³ï¸ create app ğŸ‘‰ python manage.py startapp <name>
âœ³ï¸ in an app ğŸ‘‰ apps.py is config and view.py is request handler i.e. it takes a request and returns a response
âœ³ï¸ an app should go into the installed apps list
âœ³ï¸ pipenv install django-debug-toolbar

ğŸ’¥ Data model ğŸ’¥
âœ³ï¸ good model design ğŸ‘‰ minimal coupling - high cohesion (focus)
âœ³ï¸ model classes inherit from models.Model
âœ³ï¸ field types are in models.[fieldType] like models.CharField
âœ³ï¸ django automatically creates an id field as PK for the model
âœ³ï¸ set primary_key=True for field type parameter to change the PK for the model
âœ³ï¸ create one to one relationship: set models.OneToOneField in the child model and pass the parent model as first parameter and set primary_key to True
âœ³ï¸ create one to many relationship: set models.ForeignKey in the child model and pass the parent model as first parameter
âœ³ï¸ creat many to many relationship: set models.ManyToManyField in one model and pass the other model as the first parameter, django will create reverse relationship in other model with [otherModel_set] like product_set, to overwrite this name use related_name parameter
âœ³ï¸ circular dependency: just pass the model name as a string and set related_name='+', this tells django not to make the reverse relationship
âœ³ï¸ generic relationship: content_type models.ForeignKey(ContentType), object_id = models.PositiveSmallIntegerField(), content_object = GenericForeignKey()

ğŸ’¥ configure django with postgres ğŸ’¥
âœ³ï¸ sudo apt update
âœ³ï¸ sudo apt install python3-pip python3-dev libpq-dev postgresql postgresql-contrib
âœ³ï¸ During the Postgres installation, an operating system user named postgres was created to correspond to the postgres PostgreSQL administrative user. You need to use this user to perform administrative tasks. You can use sudo and pass in the username with the -u option.
âœ³ï¸ Log into an interactive Postgres session by typing: sudo -u postgres psql
âœ³ï¸ First, you will create a database for the Django project. Each project should have its own isolated database for security reasons. We will call the database myproject in this guide, but itâ€™s always better to select something more descriptive: CREATE DATABASE myproject;
âœ³ï¸ Next, you will create a database user which you will use to connect to and interact with the database. Set the password to something strong and secure: CREATE USER myprojectuser WITH PASSWORD 'password';
âœ³ï¸ You are setting the default encoding to UTF-8, which Django expects. You are also setting the default transaction isolation scheme to â€œread committedâ€, which blocks reads from uncommitted transactions. Lastly, you are setting the timezone. By default, your Django projects will be set to use UTC. These are all recommendations from the Django project itself.
âœ³ï¸ ALTER ROLE myprojectuser SET client_encoding TO 'utf8';
ALTER ROLE myprojectuser SET default_transaction_isolation TO 'read committed';
ALTER ROLE myprojectuser SET timezone TO 'UTC';
âœ³ï¸ Now, all you need to do is give your database user access rights to the database you created: GRANT ALL PRIVILEGES ON DATABASE myproject TO myprojectuser;
âœ³ï¸ Exit the SQL prompt to get back to the postgres userâ€™s shell session: \q
âœ³ï¸ in settings.py:
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'myproject',
        'USER': 'myprojectuser',
        'PASSWORD': 'password',
        'HOST': 'localhost',
        'PORT': '',
    }
}
âœ³ï¸ While you are here, you will also need to adjust the ALLOWED_HOSTS directive. This defines a whitelist of addresses or domain names allowed to connect to the Django instance. Any incoming requests with a Host header that is not in this list will raise an exception. Django requires that you set this to prevent a certain class of security vulnerability.
# The simplest case: just add the domain name(s) and IP addresses of your Django server
# ALLOWED_HOSTS = [ 'example.com', '203.0.113.5']
# To respond to 'example.com' and any subdomains, start the domain with a dot
# ALLOWED_HOSTS = ['.example.com', '203.0.113.5']
ALLOWED_HOSTS = ['your_server_domain_or_IP']

ğŸ’¥ install pgAdmin4 on ubuntu ğŸ’¥
âœ³ï¸ https://computingforgeeks.com/how-to-install-pgadmin-4-on-ubuntu/
âœ³ï¸ add the repository to our Ubuntu system
curl  -fsSL https://www.pgadmin.org/static/packages_pgadmin_org.pub | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/pgadmin.gpg
âœ³ï¸ add pgAdmin repository in your Ubuntu system:
sudo sh -c 'echo "deb https://ftp.postgresql.org/pub/pgadmin/pgadmin4/apt/$(lsb_release -cs) pgadmin4 main" > /etc/apt/sources.list.d/pgadmin4.list'
âœ³ï¸ You can check the contents of the repository file created using the following command:
cat /etc/apt/sources.list.d/pgadmin4.list
deb https://ftp.postgresql.org/pub/pgadmin/pgadmin4/apt/bullseye pgadmin4 main
âœ³ï¸ sudo apt update
âœ³ï¸ sudo apt install pgadmin4
âœ³ï¸ Initiate Apache web server configuration.
sudo /usr/pgadmin4/bin/setup-web.sh0
This will require you to input pgadmin4 user email address and set the password
âœ³ï¸ Open your browser and http://[ServerIP_or_domain]/pgadmin4.

ğŸ’¥ Setting up the database ğŸ’¥
âœ³ï¸ python manage.py makemigrations
âœ³ï¸ python manage.py migrate
âœ³ï¸ to customize database schema use class Meta: inside a model class
âœ³ï¸ create empty migration: python manage.py makemigrations <app name> --empty then in operations list use migrations.RunSQL()
âœ³ï¸ downgrade to a specific migration: python manage.py migrate <app name> <migration> like store 0003
âœ³ï¸ mockaroo.com: to generate dummy data

ğŸ’¥ django ORM ğŸ’¥
âœ³ï¸ python manage.py runserver
âœ³ï¸ ModelName.objects.all() for example returns a query_set which encapsulates some query and django will run it in certain scenarios:
1. if you iterate over the query_set
2. when it is converted into a list: list(query_set)
3. when accessing a single element or slicing it: query_set[0] or query_set[0:5]
âœ³ï¸ ModelName.objects.get(pk=1) this might return an exception for example for pk=0
âœ³ï¸ from django.core.exceptions import ObjectDoesNotExist
âœ³ï¸ ModelName.objects.filter(pk=0).first() this returns None not an exception
âœ³ï¸ to check if something exists: ModelName.objects.filter(<condition>).exists()
âœ³ï¸ lookup types in django: field__gt, gte, lt, lte, range, contains, icontains, startswith, endswith, years, date, isnull
âœ³ï¸ from django.db.models import Q
usage: query_set = Product.objects.filter(Q(inventory__lt=20) | Q(unit_price__lt=10))
âœ³ï¸ from django.db.models import F
usage: query_set = Product.objects.filter(inventory=F('unit_price'))
âœ³ï¸ sorting: Product.objects.order_by(), earliest(), latest() 
âœ³ï¸ limit: Product.objects.all()[:5] or Product.objects.all()[5:10]
âœ³ï¸ selecting fields to query: Product.objects.values('id', 'title', 'collection__title')
âœ³ï¸ use distinct() to return a query_set with no duplicates
âœ³ï¸ defering fields: only() and defer() work the same as values but instead of dictionaries they return instances of the objects so there might be extra queries to the database in certain situations
âœ³ï¸ inner join: select_related() (1), prefetch_related() (n)
âœ³ï¸ from django.db.models.aggregates import Count, Max, Min, Avg, Sum: Product.objects.aggregate(count=Count('id'))
âœ³ï¸ Expression object in django contains Value (to set value), F (to reference fields), Func (to call db functions), Aggregate (for aggregates like sum), ExpressionWrapper (to build complex expressions)
âœ³ï¸ from django.db.models import Value
âœ³ï¸ Customer.objects.annotate(is_new=Value(True))
âœ³ï¸ grouping: query_set = Customer.objects.annotate(orders_count=Count('order'))
âœ³ï¸ querying generic relationships: from django.contrib.contenttypes.models import ContentType
content_type = ContentType.objects.get_for_model(Product)
TaggedItem.objects.select_related('tag').filter(content_type=content_type, object_id=<someId>)
âœ³ï¸ you can set custom manager for a model, this is a method you can access from the model manager i.e. Product.objects.customManager
âœ³ï¸ querySet cach happens only when you list the querySet first i.e. list(querySet) and then querySet[0] and not the other way around
âœ³ï¸ inset operation: collection = Collection() ... collection.save() or using kwarg we can use Collection.objects.create() but we lose intellisense
âœ³ï¸ update: Collection.objects.get(pk=11) then update specific fields and then .save() or Collection.objects.filter(pk=11).update(**kwarg), the first approach is robust due to automatically update when some field names change but it has a performance penalty for reading from the db first, but the second approach update directly in db but because it is using kwarg it wont automatically update
âœ³ï¸ delete: collection.delete(), bulk delete: Collection.objects.filter(id__gt=5).delete()
âœ³ï¸ atomic operation: all changes must be done together and if something fails, all changes must be roll backed, to achieve this we can use transaction decoration for a function
from django.db import transaction
@transaction.atomic()
def create_order(request):
or if you want for a part of the code to be wrapped in a transaction you can use with transaction.atomic(): inside the function body
âœ³ï¸ execute raw sql quries: Product.objects.raw('SELECT * FROM store_product) or
from django.db import connection
cursor = connection.cursor()
cursor.execute('raw query')
cursor.close() or
with connection.cursor() as cursor:
    cursor.execute() or use a stored procedure like:
with connection.cursor() as cursor:
    cursor.callproc('get_customers', [1, 2])

ğŸ’¥ the admin site ğŸ’¥
âœ³ï¸ setup admin site: python manage.py createsuperuser -> python manage.py migrate
âœ³ï¸ forget admin password: python manage.py changepassword <username of the superuser>
âœ³ï¸ register a model to show up in admin site: admin.site.register(models.Product)
âœ³ï¸ customize list page:
@admin.register(models.Product)
class ProductAdmin(admin.ModelAdmin):

ğŸ’¥ REST framework ğŸ’¥
âœ³ï¸ install the framework: pipenv install djangorestframework and then add 'rest_framework' to the installed_apps
âœ³ï¸ create endpoint: add a view for handling the request, add urls module in the app and specify the route that should be handled by that view function, add the app url in the project main urls module
âœ³ï¸ serializer: converts a model instance to a dictionary and then using render from rest_framework we can change this dict to jason object. note: changing to json object happens under the hood
âœ³ï¸ there are 4 ways to serialize relationships:
1. primary key
2. string
3. nested object
4. hyperlink

ğŸ’¥ advanced api concepts ğŸ’¥
âœ³ï¸ for neseted routers install: pipenv drf-nested-routers
âœ³ï¸